---
layout: post
title: "TryHackMe: Gallery"
date: 2025-12-04 23:00:00 +0530
categories: [TryHackMe]
tags: [tryhackme, Gallery, ctf, walkthrough, linux, privilege-escalation, web-enumeration, ssh, hacking, writeup]
render_with_liquid: false
media_subpath: /images/Gallery/
description: "An easy box where you exploit a vulnerable image gallery to gain access and escalate to root."

---

# TryHackMe: Gallery CTF — Writeup | 04 December 2025

<div align="center">
    <img src="THM.png" alt="TryHackMe Logo" width="900"/>
    <img src="Gallery.png" alt="Room Banner" width="600"/>
</div>

---

## Overview
This easy room challenges you to exploit a poorly secured image gallery web app to gain an initial shell. Then, you’ll explore the system further to escalate privileges and capture the root flag.

---

## Reconnaissance & Scanning

### Nmap

Perform a full port and service scan:

```bash
sudo nmap -Pn -T4 -n -sC -sV -p- -oN scan_nmap.txt 10.66.135.34
```

**Scan Summary:**

```
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.13 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 07:0b:16:4a:db:eb:e0:38:81:eb:55:45:a8:3d:73:25 (RSA)
|   256 80:70:5c:33:6f:34:41:ca:d5:f7:10:11:29:8d:5b:04 (ECDSA)
|_  256 eb:ce:ec:54:15:8a:fc:3b:ff:12:d2:6f:6c:af:e9:b3 (ED25519)
80/tcp   open  http    Apache httpd 2.4.41 ((Ubuntu))
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
8080/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
|_http-title: Simple Image Gallery System
|_http-open-proxy: Proxy might be redirecting requests
|_http-server-header: Apache/2.4.41 (Ubuntu)
| http-cookie-flags: 
```
- The web application is running on port 80 and 8080.
- Ssh is running on port 22.

---

## Home Page 
Accessing the web application on port 80, we see a simple page with the title "Apache2 Ubuntu.
<div align="center">
    <img src="home_page.png" alt="Home Page" width="600"/>
</div>

Nothing important here.

---

## Web Enumeration
Scan the web application using Gobuster:

```bash
gobuster dir -u http://10.66.135.34/ \                     
    -w /usr/share/wordlists/dirb/common.txt \
    -o dir_results_common.txt -t 25
 
```
**Gobuster Results:**

```
/.htaccess            (Status: 403) [Size: 277]
/.hta                 (Status: 403) [Size: 277]
/.htpasswd            (Status: 403) [Size: 277]
/gallery              (Status: 301) [Size: 314] [--> http://10.66.135.34/gallery/]
/index.html           (Status: 200) [Size: 10918]
/server-status        (Status: 403) [Size: 277]
```

- /gallery is a directory.

In `/gallery`, we see the following:

<div align="center">
    <img src="gallery_page.png" alt="Gallery Page" width="600"/>
</div>

---

## Login sql Injection
Using sql intjection, we can access the login page:

```bash
admin ' or 1=1 -- '
```

- We got the dashboard page access.

<div align="center">
    <img src="dashboard_page.png" alt="Login Page" width="600"/>
</div>

## Reverse Shell
- we can upload the file in `albums` directory.

<div align="center">
    <img src="upload_page.png" alt="Upload Page" width="600"/>
</div>

- We successfully uploaded the file in `albums` directory.

<div align="center">
    <img src="album_page.png" alt="Album Page" width="600"/>
</div>

## Access the reverse shell 
- We can access the reverse shell, using this url `http://<IP_ADDRESS>/gallery/uploads/user_1/album_2/`

<div align="center">
    <img src="reverse_shell.png" alt="Reverse Shell" width="600"/>
</div>

- we get shell access.

<div align="center">
    <img src="shell.png" alt="Shell" width="600"/>
</div>

## User privilege escalation
- We can access the `mike` user, using the `linpeas.sh` tool.

<div align="center">
    <img src="linpeas.png" alt="Linpeas" width="600"/>
</div>

- we get the `mike` user password.
- Using the password, we can access the `ssh` service.

<div align="center">
    <img src="ssh.png" alt="SSH" width="600"/>
</div>

## User Flag

<div align="center">
    <img src="user_flag.png" alt="User Flag" width="600"/>
</div>

## Root privilege escalation
We use `sudo -l` command to check for sudo permissions.

<div align="center">   
    <img src="sudo.png" alt="Sudo" width="600"/>
</div>

- We can use `/bin/bash /opt/rootkit.sh` to escalate privileges.
- We can run `/bin/bash /opt/rootkit.sh` as root.

<div align="center">
    <img src="rootkit.png" alt="Rootkit" width="600"/>
</div>

In here we can access the nano as root
- So, we can execute the command using:

```bash
clrt^R and clrt^X
reset; sh 1>&0 2>&0
```

<div align="center">
    <img src="nano.png" alt="Nano" width="600"/>
</div>

- We can get the root shell.

<div align="center">
    <img src="root_shell.png" alt="Root Shell" width="600"/>
</div>

## Root Flag

<div align="center">
    <img src="root_flag.png" alt="Root Flag" width="600"/>
</div>

---

## Hash password of the admin user?

To find the hash of the admin user. We can see the `config.php` file in `gallery` directory. 

<div align="center">
    <img src="config_php.png" alt="Config" width="600"/>
</div>

- We can find the hash of the admin user, in `classes/DBConnection.php` file.
- In `classes/DBConnection.php` file, refer to `initialize.php` file.

<div align="center">
    <img src="initialize_php.png" alt="Initialize" width="600"/>    
</div>

- We can find the hash in mysql database.
- Database name: `gallery_db`
- table name: `users`

<div align="center">
    <img src="hash.png" alt="Users" width="600"/>
</div>

## Room Complete!

<div align="center">
    <img src="completed.png" alt="Completed" width="800"/>
</div>

## Happy Hacking!

<div align="center">
    <img src="https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExY3AybG84NjRrOWwzbWl1em1nOHkzZzhmaDE1YnQ5azVqNnh0YmVsayZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/WRoLGgwE4xTQYTxyJg/giphy.gif" alt="Hacking GIF" width="800"/>
</div>
